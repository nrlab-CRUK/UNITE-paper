iteration_num_hyper <- 12
seed_number_hyper <- 0
bin_size_hyper <- "5mb"

selected_author_color <- "viridis"

# mae_file_latest <- "/scratchb/nrlab/wang04/ulyses_feat_viz/MAE5.rds"
# tier2 backup : /mnt/nas-data/nrlab/group_folders/wang04/ulyses_datasets/MAE5.rds
mae_file_latest <- "/scratchc/nrlab/wang04/build_mae/colData_batch1_2.rds_author_all_MAE.rds"



meta_file_latest <- "/home/nrlab/wang04/ulyses/meta_data/colData_batch1_2.rds"
meta_csv_latest <- "/home/nrlab/wang04/ulyses/meta_data/colData_batch1_2.csv"

# xgboost input data file
xgboost_input_data_file_hyper <- "/home/nrlab/wang04/ulyses/xgboost/xgboost_model_data.rds"

# final test bam_id list file
final_test_prop_hyper <- 0.3
final_test_hyper <- "/home/nrlab/wang04/ulyses/models/final_test_samples.rda"

isize_from_hyper <- 100
isize_to_hyper <- 220


# write a function to stratify the ichorcna_tf values
# ichorcna_tf_strat <- function(ichorcna_tf) {
#         cut(ichorcna_tf,
#                 breaks = c(0, 0.03, 0.1, 0.2, 1),
#                 labels = c("[0, 0.03]", "(0.03, 0.1]", "(0.1, 0.2]", "(0.2, 1]"),
#                 include.lowest = TRUE
#         )
# }

add_ichorcna_tf_strat_col <- function(input) {
        ans <- input |>
                dplyr::mutate(ichorcna_tf_strat = dplyr::case_when(
                        ichorcna_tf <= 0.03 ~ "[0, 0.03]",
                        ichorcna_tf <= 0.1 & ichorcna_tf > 0.03 ~ "(0.03, 0.1]",
                        ichorcna_tf <= 1 & ichorcna_tf > 0.1 ~ "(0.1, 1]",
                        # ichorcna_tf <= 1 & ichorcna_tf > 0.2 ~ "(0.2, 1]",
                        TRUE ~ "unknown"
                ))
        return(ans)
}


ichorcna_tf_strat_col_levels_hyper <- c(
        "Healthy",
        "[0, 0.03]",
        "(0.03, 0.1]",
        "(0.1, 1]"
)

ichorcna_tf_strat_col_levels_alluvial_hyper <- c(
        "Healthy",
        "[0, 0.03]",
        "(0.03, 0.1]",
        "(0.1, 1]",
        "unknown"
)

# downsampled_bams_data_path_hyper

downsampled_plasma_bams_data_path_hyper <- c(
        "/scratchc/nrlab/wang04/ulyses/data/delfi",
        "/scratchc/nrlab/wang04/ulyses/data/finaledb",
        "/scratchc/nrlab/wang04/ulyses/data/liquorice",
        "/scratchc/nrlab/wang04/ulyses/data/stm_paper_data",
        "/scratchc/nrlab/wang04/ulyses_second_batch/data/dan_landau",
        "/scratchc/nrlab/wang04/ulyses_second_batch/data/ellen_heitzer",
        "/scratchc/nrlab/wang04/ulyses_second_batch/data/lucid",
        "/scratchc/nrlab/wang04/ulyses_second_batch/data/oee",
        "/scratchc/nrlab/wang04/ulyses_second_batch/data/pbcp"
)


cancer_color_hyper <- "tomato3"
healthy_color_hyper <- "grey"

# authors_hyper <- c(
#         "P.P. et al", # liquorice
#         "F.M. et al", # mouliere STM size selection paper
#         "S.C. et al", # delfi nature letter
#         "V.A. et al", # viktor  nat comms ichorCNA
#         "P.J. et al", # peiyong jiang
#         "K.S. et al", # kun sun
#         "M.S. et al", # mike snyder schendure Cell
#         "A.Z. et al", # asaf zviran, dan landau, C2I startup, acquired by Verocyte
#         "K.H. et al", # lucid baseline sWGS, not published
#         "D.G. et al", # same as above, lucid baseline sWGS, not published
#         "A.S. et al", # pbcp
#         "P.M. et al", # oee, paulius, chris, davina
#         "P.U. et al" # peter ulz, ellen heitzer
# )

# author_color_values_hyper <- colorspace::diverge_hcl(length(authors_hyper))
# the color code was generated by the code below
# author_color_values_hyper <- randomcoloR::distinctColorPalette((length(authors_hyper)))

pp_color <- "#E3796D"
fm_color <- "#B14DE5"
sc_color <- "#DAC975"
va_color <- "#DEDACB"
pj_color <- "#918082"
ks_color <- "#B7E954"
ms_color <- "#DDADD5"
az_color <- "#DA65B5"
kh_color <- "#7EDAD2"
as_color <- "#8A82DE"
pm_color <- "#82DE9C"
pu_color <- "#82B2DD"
eh_color <- "#82B2DD"

author_color_values_hyper <- c(
        "A.S. et al" = as_color,
        "A.Z. et al" = az_color,
        "P.U. et al" = pu_color,
        "F.M. et al" = fm_color,
        "K.H. et al" = kh_color,
        "K.S. et al" = ks_color,
        "M.S. et al" = ms_color,
        "P.J. et al" = pj_color,
        "P.M. et al" = pm_color,
        "P.P. et al" = pp_color,
        "S.C. et al" = sc_color,
        "V.A. et al" = va_color
        # "K.H. et al" = kh_color,
)

authors_hyper <- names(author_color_values_hyper)

author_color_values_hyper_viridis <- viridis::plasma(length(authors_hyper))
names(author_color_values_hyper_viridis) <- authors_hyper

if (selected_author_color == "viridis") {
        author_color_values_hyper <- author_color_values_hyper_viridis
} else {
        author_color_values_hyper <- author_color_values_hyper
}

author_rename_vec_hyper <- c(
        # NRLAB
        "P.M. et al" = "This study",
        "F.M. et al" = "Mouliere et al, 2018",
        "K.H. et al" = "Gale et al, 2022",
        "A.S. et al" = "Santonja et al, 2023",
        # EGA
        "P.U. et al" = "Ulz et al, 2019",
        "A.Z. et al" = "Zviran et al, 2020",
        "P.P. et al" = "Peneder et al, 2021",
        # FINALEDB
        "P.J. et al" = "Jiang et al, 2015",
        "M.S. et al" = "Snyder et al, 2016",
        "V.A. et al" = "Adalsteinsson et al, 2017",
        "K.S. et al" = "Sun et al, 2019",
        "S.C. et al" = "Cristiano et al, 2019"
)


tf_strat_healthy_color <- "#A3BE8C"
tf_strat_0_0.01_color <- "#D08770"
tf_strat_0.03_0.1_color <- "#EBCB8B"
tf_strat_0.01_0.03_color <- "#E0AF80"
tf_strat_0.1_0.2_color <- "#B48EAD"
tf_strat_0.2_1_color <- "#BF616A"


# tf_strat_healthy_color <- healthy_color_hyper
# tf_strat_0_0.01_color <- "royalblue"
# tf_strat_0.01_0.03_color <- "#699124"
# tf_strat_0.03_0.1_color <- "orange3"
# tf_strat_0.1_0.2_color <- "red"
# tf_strat_0.2_1_color <- "black"


ichorcna_tf_strat_color_hyper <- c(
        "Healthy" = tf_strat_healthy_color,
        "[0, 0.03]" = tf_strat_0.01_0.03_color,
        "(0.03, 0.1]" = tf_strat_0.03_0.1_color,
        # "(0.1, 0.2]" = tf_strat_0.1_0.2_color,
        "(0.1, 1]" = tf_strat_0.2_1_color
)

ichorcna_tf_strat_hyper <- names(ichorcna_tf_strat_color_hyper)
ichorcna_tf_strat_for_model_performance_hyper <- c(
        "[0, 0.03]",
        "(0.03, 0.1]",
        "(0.1, 1]",
        "all"
)

################################################################################
# stage colors
stage_color_hyper <- c(
        "I" = "#FECE91FF",
        "II" = "#DE4968FF",
        "III" = "#641A80FF",
        "IV" = "#000004FF",
        "Others" = "lightgrey",
        NA_real = "lightgrey"
)



data_source_hyper <- c("NRLAB", "EGA", "FINALEDB")

tp_levels_hyper <- c(as.character(1:20))

assay_to_keep_hyper <- c("sd", "length", "sl_ratio", "cnv", "motif_ratio")
sample_type_hyper <- c("plasma")

cohorts_hyper <- c(
        "Healthy",
        "Ews",
        "Non-Ews Sarcoma",
        "Breast",
        "Bladder",
        "Colorectal",
        "Colon",
        "Cervical",
        "Cholangiocarcinoma",
        "Endometrial",
        "Head and Neck",
        "Testicular",
        "Uterine",
        "Glioblastoma",
        "Hepatocellular",
        "Ovarian",
        "Lung",
        "Melanoma",
        "Esophageal",
        "Pancreatic",
        "Penile",
        "Prostate",
        "Rectum",
        "Renal",
        "Thymoma",
        "Bile Duct",
        "Duodenal",
        "Gastric"
)


noncancer_disease_hyper <- c(
        "Cirrhosis",
        "Hepatitis B",
        "Inflammatory Bowel Disease",
        "Liver Transplant",
        "Systemic Lupus Erythematosus"
)



outliers_hyper <- c(
        "EE87920",
        "EE87921",
        "EE86749",
        "EE86532",
        "SLX-10572.D704-D505",
        "SLX-11870.D712-D503"
)


# caner sample example id
cancer_id_example <- "EE87033"
healthy_id_example <- "EE87922"

# ggplot2 themes
theme_NPJ <- function(linewidth = 0.5,
                      font_familty = "sans",
                      axis_label_font_size = 5,
                      axis_title_font_size = 5.5) {
        theme_classic() %+replace%
                theme(
                        text = element_text(family = font_familty),
                        line = element_line(linewidth = linewidth),
                        axis.text = element_text(size = axis_label_font_size),
                        axis.title = element_text(size = axis_title_font_size),
                        # legend background to transparent
                        panel.background = element_rect(fill = "transparent", color = NA), # transparent panel bg
                        plot.background = element_rect(fill = "transparent", color = NA), # transparent plot bg
                        legend.background = element_rect(fill = "transparent", color = NA), # transparent legend bg
                        legend.box.background = element_rect(fill = "transparent", color = NA), # transparent legend panel
                        legend.margin = margin(0, 0, 0, 0),
                        legend.box.margin = margin(0, 0, 0, 0), # The margin around the legend box (unit)
                        legend.box.spacing = unit(0, "pt"), # The spacing between the plotting area and the legend box (unit)
                        # plot margin
                        plot.margin = margin(0.01, 0.01, 0.01, 0.01, "cm"),
                        plot.title = element_text(size = 5.5),      # Set the plot title size to 5.5
                        legend.title = element_text(size = 5),    # Set the legend title size to 5.5
                        legend.text = element_text(size = 5)
                )
}


pvalue_font_size_hyper <- 2.4
heatmap_col_title_font_size_hyper <- 5
